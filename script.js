const translations = {
    en: {
        nav_overview: "Overview",
        nav_products: "Products",
        nav_installation: "Installation",
        nav_faq: "FAQ",
        nav_contact: "Contact",
        hero_title: "RVS Platen & Stainless Steel<br><span style='font-size: 0.7em; font-weight: 300;'>Professional Solutions</span>",
        hero_subtitle: "Custom RVS Platen (AISI 304) for modern professional kitchens.",
        hero_cta: "View Products <i class='fas fa-chevron-right'></i>",
        hero_desc: "High-quality RVS Platen (AISI 304) brushed finish.",
        footer_rights: "All rights reserved.",
        footer_privacy: "Privacy Policy",
        footer_terms: "Terms of Service",
        footer_legal: "Legal Notice",
        cart_title: "Your Order",
        cart_total: "Total",
        checkout_btn: "Proceed to Checkout",
        size_label: "Size",
        material_label: "Material",
        // Product specific
        product_title: "Professional AISI 304 Stainless Steel Sheet",
        product_desc: "Premium AISI 304 stainless steel backsplash sheet with professional dual finish. One side features a refined brushed texture, the other a mirror-polished surface. Laser protection film applied on polished side for scratch-free delivery. Certified for professional kitchen environments and direct food contact.",
        feat_iso: "ISO Standard",
        feat_heat: "Heat Resistant",
        feat_food: "Food Certified",
        feat_dual: "Dual Surface",
        mat_desc: "1 Side Brushed / 1 Side Polished Mirror",
        // Dynamic & Sections
        btn_buy_small: "Buy",
        price_from: "From",
        stock_low: "Only {n} units left!",
        stock_ok: "In stock, ships: 1 business day",
        modal_add_btn: "Add to Bag",
        cust_eyebrow: "Bespoke Design",
        cust_title: "Customizer Ecosystem",
        cust_desc: "Design your perfect fit with real-time visual feedback.",
        cust_width: "Width (mm)",
        cust_height: "Height (mm)",
        cust_quote_label: "Estimated Quote",
        cust_excl_ship: "Excl. Shipping",
        cust_req_btn: "Request This Configuration",
        mat_304: "AISI 304 - Professional",
        inst_eyebrow: "Expert Advice",
        inst_title: "How to Install",
        faq_title: "Frequently Asked Questions",
        cart_empty: "Your cart is empty",
        cart_remove: "Remove",
        // Section headings
        section_heading: "Professional AISI 304 Series",
        trust_secure: "Secure Payment",
        trust_delivery: "FREE Delivery > ‚Ç¨599.99",
        trust_quality: "Quality Guaranteed",
        // Feature Big
        feat_big_title: "Industrial Grade.",
        feat_big_desc: "Sourced from the finest materials to ensure durability and strength.",
        // Installation steps
        inst_desc: "Mounting your professional backsplash is a straightforward process. For the best result, we recommend using high-quality transparent silicone adhesive.",
        inst_step1_title: "Clean the Wall",
        inst_step1_desc: "Ensure the surface is dry and free of grease.",
        inst_step2_title: "Apply Silicone",
        inst_step2_desc: "Apply vertical strips of transparent silicone on the back of the sheet.",
        inst_step3_title: "Press and Secure",
        inst_step3_desc: "Place against the wall and press firmly. Use masking tape to hold it in place while it cures.",
        // FAQ
        faq_q1: "Is AISI 304 heat resistant?",
        faq_a1: "Yes, our stainless steel is highly heat resistant, making it perfect for use behind gas cooktops and stoves.",
        faq_q2: "How do I clean the brushed finish?",
        faq_a2: "Simply use a damp cloth with mild soap or a specialized stainless steel cleaner. Always wipe in the direction of the grain.",
        faq_q3: "Do you ship to my country?",
        faq_a3: "We ship across the entire European Union. Delivery times typically range from 3 to 5 business days.",
        faq_q4: "Can I get a custom size?",
        faq_a4: "Absolutely. We offer custom cutting services for projects that require non-standard dimensions.",
        // Footer
        footer_brand_desc: "Professional kitchen solutions for the modern home and industry.",
        footer_col_products: "Products",
        footer_steel: "Steel Plates",
        footer_customizer: "Customizer Ecosystem",
        footer_col_support: "Support",
        footer_install_guide: "Installation Guide",
        footer_faq_link: "FAQ & Support",
        footer_contact_title: "Contact Business",
        footer_hours: "Support Hours: Mon-Fri 9:00 - 18:00",
        // Modal
        modal_new: "New",
        modal_select_size: "Select Size",
        modal_material_label: "Material",
        modal_dims_label: "Dimensions",
        modal_dims_placeholder: "Select a size above",
        modal_cert_title: "Industry Certified",
        modal_cert_desc: "AISI 304 stainless steel is the professional industry standard approved for food contact and high-hygiene environments (EU 1935/2004 compliance).",
        modal_ships: "Ships: 1 business day",
        modal_laser_bonus: "Includes Free Laser Film",
        // Success modal
        success_title: "Order Successful!",
        success_desc: "Thank you for choosing ProTech Solutions. Your professional backsplash is being prepared for shipment.",
        success_email_note: "A confirmation email has been sent to your inbox.",
        success_pickup_title: "Pickup Locations",
        success_continue: "Continue Browsing",
        // Cart
        cart_empty_msg: "Your bag is empty.",
        toast_added: "Added to bag",
        // Trust & Why
        trust_food_safe: "Food Safe (EU 1935/2004)",
        trust_iso: "ISO 9001 Certified Quality",
        trust_fast_ship: "Fast 24h Preparation",
        trust_best_price: "Best Price Guarantee",
        why_eyebrow: "The ProTech Difference",
        why_title: "Why choose ProTech Solutions?",
        why_direct_title: "Direct from Factory",
        why_direct_desc: "No middlemen. We manufacture every sheet in our local facilities to ensure the highest quality.",
        why_packaging_title: "Premium Protection",
        why_packaging_desc: "Every RVS Platen comes with a heavy-duty laser film for scratch-free arrival.",
        why_custom_title: "Precision Cut",
        why_custom_desc: "Using state-of-the-art fiber lasers, we ensure your backsplash fits perfectly.",
        // SEO
        seo_desc: "Order custom RVS Platen (AISI 304 Stainless Steel Sheets) for your kitchen. Professional grade, heat resistant, and food certified. Made to measure in Belgium & Spain.",
        shipping_free_unlocked: "Free shipping unlocked!",
        shipping_away_prefix: "Only",
        shipping_away_suffix: "away from FREE shipping!"
    },
    es: {
        nav_overview: "Inicio",
        nav_products: "Productos",
        nav_installation: "Instalaci√≥n",
        nav_faq: "Preguntas",
        nav_contact: "Contacto",
        hero_title: "RVS Platen & Acero Inox<br><span style='font-size: 0.7em; font-weight: 300;'>Soluciones Profesionales</span>",
        hero_subtitle: "RVS Platen (Acero Inox AISI 304) a medida para cocinas modernas.",
        hero_cta: "Ver Productos <i class='fas fa-chevron-right'></i>",
        hero_desc: "RVS Platen AISI 304 de alta calidad con acabado cepillado.",
        footer_rights: "Todos los derechos reservados.",
        footer_privacy: "Pol√≠tica de Privacidad",
        footer_terms: "T√©rminos de Servicio",
        footer_legal: "Aviso Legal",
        cart_title: "Tu Pedido",
        cart_total: "Total",
        checkout_btn: "Finalizar Compra",
        size_label: "Medida",
        material_label: "Material",
        // Product specific
        product_title: "Plancha Inox AISI 304 Profesional",
        product_desc: "Plancha antisalpicaduras de acero inoxidable AISI 304 premium con doble acabado profesional. Una cara con textura cepillada refinada, la otra pulida espejo. Film protector l√°ser en la cara pulida. Certificado para entornos de cocina profesional y contacto con alimentos.",
        feat_iso: "Est√°ndar ISO",
        feat_heat: "Resistente al Calor",
        feat_food: "Certificado Alimentario",
        feat_dual: "Doble Acabado",
        mat_desc: "1 Cara Cepillada / 1 Cara Espejo",
        // Dynamic & Sections
        btn_buy_small: "Comprar",
        price_from: "Desde",
        stock_low: "¬°Solo quedan {n} unidades!",
        stock_ok: "En stock, env√≠o: 1 d√≠a laborable",
        modal_add_btn: "A√±adir a la Cesta",
        cust_eyebrow: "Dise√±o a Medida",
        cust_title: "Personalizador Real",
        cust_desc: "Dise√±a tu medida perfecta con vista previa en tiempo real.",
        cust_width: "Ancho (mm)",
        cust_height: "Alto (mm)",
        cust_quote_label: "Presupuesto Estimado",
        cust_excl_ship: "Excl. Env√≠o",
        cust_req_btn: "Solicitar esta Configuraci√≥n",
        mat_304: "AISI 304 - Profesional",
        inst_eyebrow: "Consejo Experto",
        inst_title: "C√≥mo Instalar",
        faq_title: "Preguntas Frecuentes",
        cart_empty: "Tu carrito est√° vac√≠o",
        cart_remove: "Eliminar",
        // Section headings
        section_heading: "Serie Profesional AISI 304",
        trust_secure: "Pago Seguro",
        trust_delivery: "Env√≠o GRATIS > ‚Ç¨599.99",
        trust_quality: "Calidad Garantizada",
        // Feature Big
        feat_big_title: "Calidad Industrial.",
        feat_big_desc: "Materiales de primera calidad para garantizar durabilidad y resistencia.",
        // Installation steps
        inst_desc: "Montar tu plancha antisalpicaduras es un proceso sencillo. Para el mejor resultado, recomendamos usar silicona transparente de alta calidad.",
        inst_step1_title: "Limpiar la Pared",
        inst_step1_desc: "Aseg√∫rate de que la superficie est√© seca y libre de grasa.",
        inst_step2_title: "Aplicar Silicona",
        inst_step2_desc: "Aplica tiras verticales de silicona transparente en la parte trasera de la plancha.",
        inst_step3_title: "Presionar y Fijar",
        inst_step3_desc: "Coloca contra la pared y presiona firmemente. Usa cinta de carrocero para sujetarla mientras seca.",
        // FAQ
        faq_q1: "¬øEl AISI 304 es resistente al calor?",
        faq_a1: "S√≠, nuestro acero inoxidable es altamente resistente al calor, ideal para usar detr√°s de cocinas de gas y hornos.",
        faq_q2: "¬øC√≥mo limpio el acabado cepillado?",
        faq_a2: "Simplemente usa un pa√±o h√∫medo con jab√≥n suave o un limpiador especializado para acero inoxidable. Siempre limpia en la direcci√≥n del grano.",
        faq_q3: "¬øEnv√≠an a mi pa√≠s?",
        faq_a3: "Enviamos a toda la Uni√≥n Europea. Los plazos de entrega son normalmente de 3 a 5 d√≠as laborables.",
        faq_q4: "¬øPuedo pedir un tama√±o personalizado?",
        faq_a4: "Por supuesto. Ofrecemos servicios de corte a medida para proyectos que requieran dimensiones no est√°ndar.",
        // Footer
        footer_brand_desc: "Soluciones profesionales de cocina para el hogar moderno y la industria.",
        footer_col_products: "Productos",
        footer_steel: "Planchas de Acero",
        footer_customizer: "Personalizador",
        footer_col_support: "Soporte",
        footer_install_guide: "Gu√≠a de Instalaci√≥n",
        footer_faq_link: "Preguntas Frecuentes",
        footer_contact_title: "Contacto Comercial",
        footer_hours: "Horario: L-V 9:00 - 18:00",
        // Modal
        modal_new: "Nuevo",
        modal_select_size: "Seleccionar Tama√±o",
        modal_material_label: "Material",
        modal_dims_label: "Dimensiones",
        modal_dims_placeholder: "Selecciona un tama√±o arriba",
        modal_cert_title: "Certificado Industrial",
        modal_cert_desc: "El acero inoxidable AISI 304 es el est√°ndar profesional aprobado para contacto con alimentos y entornos de alta higiene (cumplimiento EU 1935/2004).",
        modal_ships: "Env√≠o: 1 d√≠a laborable",
        modal_laser_bonus: "Incluye Film L√°ser Gratis",
        // Success modal
        success_title: "¬°Pedido Realizado!",
        success_desc: "Gracias por elegir ProTech Solutions. Tu plancha profesional se est√° preparando para el env√≠o.",
        success_email_note: "Se ha enviado un email de confirmaci√≥n a tu bandeja de entrada.",
        success_pickup_title: "Puntos de Recogida",
        success_continue: "Seguir Comprando",
        // Cart
        cart_empty_msg: "Tu cesta est√° vac√≠a.",
        toast_added: "A√±adido a la cesta",
        // Trust & Why
        trust_food_safe: "Certificado Alimentario",
        trust_iso: "Calidad ISO 9001",
        trust_fast_ship: "Preparaci√≥n en 24h",
        trust_best_price: "Mejor Precio Garantizado",
        why_eyebrow: "La Diferencia ProTech",
        why_title: "¬øPor qu√© elegir ProTech?",
        why_direct_title: "Directo de F√°brica",
        why_direct_desc: "Sin intermediarios. Fabricamos cada plancha para garantizar la m√°xima calidad.",
        why_packaging_title: "Protecci√≥n Premium",
        why_packaging_desc: "Cada RVS Platen incluye film l√°ser reforzado para evitar ara√±azos.",
        why_custom_title: "Corte de Precisi√≥n",
        why_custom_desc: "Corte l√°ser de fibra para un ajuste perfecto al mil√≠metro.",
        // SEO
        seo_desc: "Pida sus RVS Platen (Planchas Inox AISI 304) a medida. Calidad profesional, resistentes al calor y certificadas para alimentos. Env√≠o a toda Europa.",
        shipping_free_unlocked: "¬°Env√≠o gratuito desbloqueado!",
        shipping_away_prefix: "¬°Solo",
        shipping_away_suffix: "m√°s para env√≠o GRATIS!"
    },
    nl: {
        nav_overview: "Overzicht",
        nav_products: "Producten",
        nav_installation: "Installatie",
        nav_faq: "FAQ",
        nav_contact: "Contact",
        hero_title: "RVS Platen & RVS Staal<br><span style='font-size: 0.7em; font-weight: 300;'>Professionele Oplossingen</span>",
        hero_subtitle: "Professionele RVS Platen (AISI 304) voor moderne keukens.",
        hero_cta: "Bekijk Producten <i class='fas fa-chevron-right'></i>",
        hero_desc: "Hoogwaardige RVS Platen AISI 304 met geborstelde afwerking.",
        footer_rights: "Alle rechten voorbehouden.",
        footer_privacy: "Privacybeleid",
        footer_terms: "Algemene Voorwaarden",
        footer_legal: "Wettelijke Vermelding",
        cart_title: "Uw Bestelling",
        cart_total: "Totaal",
        checkout_btn: "Afrekenen",
        size_label: "Afmeting",
        material_label: "Materiaal",
        // Product specific
        product_title: "Professionele AISI 304 RVS Plaat",
        product_desc: "Premium AISI 304 RVS achterwand met professionele dubbele afwerking. E√©n zijde met verfijnde geborstelde structuur, de andere spiegelgepolijst. Laserbeschermfolie aangebracht op gepolijste zijde. Gecertificeerd voor professionele keukens en voedselcontact.",
        feat_iso: "ISO Standaard",
        feat_heat: "Hittebestendig",
        feat_food: "Voedselveilig",
        feat_dual: "Dubbel Oppervlak",
        mat_desc: "1 Zijde Geborsteld / 1 Zijde Spiegel",
        // Dynamic & Sections
        btn_buy_small: "Kopen",
        price_from: "Vanaf",
        stock_low: "Nog maar {n} stuks over!",
        stock_ok: "Op voorraad, verzending: 1 werkdag",
        modal_add_btn: "In Winkelwagen",
        cust_eyebrow: "Maatwerk Design",
        cust_title: "Live Customizer",
        cust_desc: "Ontwerp uw perfecte pasvorm met real-time voorbeeld.",
        cust_width: "Breedte (mm)",
        cust_height: "Hoogte (mm)",
        cust_quote_label: "Geschatte Prijs",
        cust_excl_ship: "Excl. Verzending",
        cust_req_btn: "Deze Configuratie Aanvragen",
        mat_304: "AISI 304 - Professioneel",
        inst_eyebrow: "Experttip",
        inst_title: "Installatiegids",
        faq_title: "Veelgestelde Vragen",
        cart_empty: "Uw winkelwagen is leeg",
        cart_remove: "Verwijderen",
        // Section headings
        section_heading: "Professionele AISI 304 Serie",
        trust_secure: "Veilig Betalen",
        trust_delivery: "GRATIS Bezorging > ‚Ç¨599.99",
        trust_quality: "Kwaliteit Gegarandeerd",
        // Feature Big
        feat_big_title: "Industri√´le Kwaliteit.",
        feat_big_desc: "Afkomstig van de beste materialen voor duurzaamheid en sterkte.",
        // Installation steps
        inst_desc: "Het monteren van uw professionele achterwand is een eenvoudig proces. Voor het beste resultaat raden wij transparante siliconenkit van hoge kwaliteit aan.",
        inst_step1_title: "Muur Schoonmaken",
        inst_step1_desc: "Zorg ervoor dat het oppervlak droog en vetvrij is.",
        inst_step2_title: "Siliconen Aanbrengen",
        inst_step2_desc: "Breng verticale strepen transparante siliconen aan op de achterkant van de plaat.",
        inst_step3_title: "Aandrukken en Bevestigen",
        inst_step3_desc: "Plaats tegen de muur en druk stevig aan. Gebruik afplaktape om het op zijn plaats te houden terwijl het uithardt.",
        // FAQ
        faq_q1: "Is AISI 304 hittebestendig?",
        faq_a1: "Ja, ons roestvrij staal is zeer hittebestendig en perfect voor gebruik achter gaskookplaten en fornuizen.",
        faq_q2: "Hoe reinig ik de geborstelde afwerking?",
        faq_a2: "Gebruik een vochtige doek met milde zeep of een gespecialiseerde RVS-reiniger. Veeg altijd in de richting van de structuur.",
        faq_q3: "Leveren jullie in mijn land?",
        faq_a3: "Wij leveren in de hele Europese Unie. Levertijden zijn doorgaans 3 tot 5 werkdagen.",
        faq_q4: "Kan ik een maat op maat krijgen?",
        faq_a4: "Absoluut. Wij bieden maatwerksnijdiensten aan voor projecten die niet-standaard afmetingen vereisen.",
        // Footer
        footer_brand_desc: "Professionele keukenoplossingen voor het moderne huis en de industrie.",
        footer_col_products: "Producten",
        footer_steel: "RVS Platen",
        footer_customizer: "Live Customizer",
        footer_col_support: "Ondersteuning",
        footer_install_guide: "Installatiegids",
        footer_faq_link: "FAQ & Ondersteuning",
        footer_contact_title: "Zakelijk Contact",
        footer_hours: "Bereikbaar: Ma-Vr 9:00 - 18:00",
        // Modal
        modal_new: "Nieuw",
        modal_select_size: "Kies Afmeting",
        modal_material_label: "Materiaal",
        modal_dims_label: "Afmetingen",
        modal_dims_placeholder: "Kies eerst een afmeting hierboven",
        modal_cert_title: "Industrieel Gecertificeerd",
        modal_cert_desc: "AISI 304 roestvrij staal is de professionele industriestandaard, goedgekeurd voor voedselcontact en omgevingen met hoge hygi√´ne-eisen (EU 1935/2004).",
        modal_ships: "Verzending: 1 werkdag",
        modal_laser_bonus: "Gratis Laserfolie Inbegrepen",
        // Success modal
        success_title: "Bestelling Gelukt!",
        success_desc: "Bedankt voor uw keuze voor ProTech Solutions. Uw professionele achterwand wordt voorbereid voor verzending.",
        success_email_note: "Een bevestigingsmail is naar uw inbox gestuurd.",
        success_pickup_title: "Afhaalpunten",
        success_continue: "Verder Winkelen",
        // Cart
        cart_empty_msg: "Uw winkelwagen is leeg.",
        toast_added: "Toegevoegd aan winkelwagen",
        // Trust & Why
        trust_food_safe: "Voedselveilig (EU 1935/2004)",
        trust_iso: "ISO 9001 Gecertificeerd",
        trust_fast_ship: "24u Voorbereiding",
        trust_best_price: "Laagste Prijsgarantie",
        why_eyebrow: "Het ProTech Verschil",
        why_title: "Waarom kiezen voor ProTech?",
        why_direct_title: "Direct van de Fabriek",
        why_direct_desc: "Geen tussenpersonen. Wij produceren alles zelf voor de beste prijs.",
        why_packaging_title: "Premium Bescherming",
        why_packaging_desc: "Elke RVS Plaat komt met dikke laserfolie voor krasvrije levering.",
        why_custom_title: "Precisie Snijwerk",
        why_custom_desc: "Dankzij onze fiberlasers past uw achterwand tot op de millimeter.",
        // SEO
        seo_desc: "Beste prijs voor RVS Platen op maat! Professionele AISI 304 roestvrijstalen achterwanden en spatwanden. Hittebestendig, voedselveilig en duurzaam. Gratis verzending > ‚Ç¨599.99.",
        shipping_free_unlocked: "Gratis verzending ontgrendeld!",
        shipping_away_prefix: "Nog maar",
        shipping_away_suffix: "verwijderd van GRATIS verzending!"
    },
    fr: {
        nav_overview: "Aper√ßu",
        nav_products: "Produits",
        nav_installation: "Installation",
        nav_faq: "FAQ",
        nav_contact: "Contact",
        hero_title: "RVS Platen & Inox Premium<br><span style='font-size: 0.7em; font-weight: 300;'>Solutions Professionnelles</span>",
        hero_subtitle: "RVS Platen (Inox AISI 304) sur mesure pour cuisines modernes.",
        hero_cta: "Voir les Produits <i class='fas fa-chevron-right'></i>",
        hero_desc: "RVS Platen (Inox AISI 304) de haute qualit√©, finition bross√©e.",
        footer_rights: "Tous droits r√©serv√©s.",
        footer_privacy: "Politique de Confidentialit√©",
        footer_terms: "Conditions d'Utilisation",
        footer_legal: "Mentions L√©gales",
        cart_title: "Votre Commande",
        cart_total: "Total",
        checkout_btn: "Passer √† la Caisse",
        size_label: "Taille",
        material_label: "Mat√©riau",
        // Product specific
        product_title: "Plaque Inox AISI 304 Professionnelle",
        product_desc: "Plaque de cr√©dence en acier inoxydable AISI 304 premium avec double finition professionnelle. Une face pr√©sente une texture bross√©e raffin√©e, l'autre une surface polie miroir. Film de protection laser appliqu√© sur la face polie. Certifi√© pour les environnements de cuisine professionnelle et le contact alimentaire direct.",
        feat_iso: "Norme ISO",
        feat_heat: "R√©sistant √† la Chaleur",
        feat_food: "Certifi√© Alimentaire",
        feat_dual: "Double Surface",
        mat_desc: "1 Face Bross√©e / 1 Face Polie Miroir",
        // Dynamic & Sections
        btn_buy_small: "Acheter",
        price_from: "√Ä partir de",
        stock_low: "Plus que {n} unit√©s !",
        stock_ok: "En stock, exp√©dition : 1 jour ouvr√©",
        modal_add_btn: "Ajouter au Panier",
        cust_eyebrow: "Design sur Mesure",
        cust_title: "Ecosyst√®me de Personnalisation",
        cust_desc: "Concevez votre ajustement parfait avec un retour visuel en temps r√©el.",
        cust_width: "Largeur (mm)",
        cust_height: "Hauteur (mm)",
        cust_quote_label: "Devis Estim√©",
        cust_excl_ship: "Hors Livraison",
        cust_req_btn: "Demander cette Configuration",
        mat_304: "AISI 304 - Professionnel",
        inst_eyebrow: "Conseils d'Experts",
        inst_title: "Comment Installer",
        faq_title: "Questions Fr√©quemment Pos√©es",
        cart_empty: "Votre panier est vide",
        cart_remove: "Supprimer",
        // Section headings
        section_heading: "S√©rie Professionnelle AISI 304",
        trust_secure: "Paiement S√©curis√©",
        trust_delivery: "Livraison GRATUITE > 599,99 ‚Ç¨",
        trust_quality: "Qualit√© Garantie",
        // Feature Big
        feat_big_title: "Qualit√© Industrielle.",
        feat_big_desc: "Issu des meilleurs mat√©riaux pour garantir durabilit√© et r√©sistance.",
        // Installation steps
        inst_desc: "Le montage de votre cr√©dence professionnelle est un processus simple. Pour un r√©sultat optimal, nous recommandons l'utilisation d'un adh√©sif silicone transparent de haute qualit√©.",
        inst_step1_title: "Nettoyer le Mur",
        inst_step1_desc: "Assurez-vous que la surface est s√®che et exempte de graisse.",
        inst_step2_title: "Appliquer le Silicone",
        inst_step2_desc: "Appliquez des bandes verticales de silicone transparent au dos de la plaque.",
        inst_step3_title: "Presser et Fixer",
        inst_step3_desc: "Placez contre le mur et pressez fermement. Utilisez du ruban de masquage pour maintenir en place pendant le s√©chage.",
        // FAQ
        faq_q1: "L'AISI 304 est-il r√©sistant √† la chaleur ?",
        faq_a1: "Oui, notre acier inoxydable est tr√®s r√©sistant √† la chaleur, ce qui le rend parfait pour une utilisation derri√®re les plaques de cuisson √† gaz.",
        faq_q2: "Comment nettoyer la finition bross√©e ?",
        faq_a2: "Utilisez simplement un chiffon humide avec du savon doux ou un nettoyant sp√©cialis√© pour inox. Essuyez toujours dans le sens du grain.",
        faq_q3: "Livrez-vous dans mon pays ?",
        faq_a3: "Nous livrons dans toute l'Union Europ√©enne. Les d√©lais de livraison varient g√©n√©ralement de 3 √† 5 jours ouvr√©s.",
        faq_q4: "Puis-je obtenir une taille personnalis√©e ?",
        faq_a4: "Absolument. Nous proposons des services de d√©coupe sur mesure pour les projets n√©cessitant des dimensions non standard.",
        // Footer
        footer_brand_desc: "Solutions de cuisine professionnelle pour la maison moderne et l'industrie.",
        footer_col_products: "Produits",
        footer_steel: "Plaques d'Acier",
        footer_customizer: "Personnalisation en Direct",
        footer_col_support: "Support",
        footer_install_guide: "Guide d'Installation",
        footer_faq_link: "FAQ & Support",
        footer_contact_title: "Contact Professionnel",
        footer_hours: "Heures de Support : Lun-Ven 9:00 - 18:00",
        // Modal
        modal_new: "Nouveau",
        modal_select_size: "Choisir la Taille",
        modal_material_label: "Mat√©riau",
        modal_dims_label: "Dimensions",
        modal_dims_placeholder: "Choisissez une taille ci-dessus",
        modal_cert_title: "Certifi√© Industriel",
        modal_cert_desc: "L'acier inoxydable AISI 304 est la norme industrielle professionnelle approuv√©e pour le contact alimentaire et les environnements √† haute hygi√®ne (conformit√© UE 1935/2004).",
        modal_ships: "Exp√©dition : 1 jour ouvr√©",
        modal_laser_bonus: "Comprend un Film Laser Gratuit",
        // Success modal
        success_title: "Commande R√©ussie !",
        success_desc: "Merci d'avoir choisi ProTech Solutions. Votre cr√©dence professionnelle est en cours de pr√©paration pour l'exp√©dition.",
        success_email_note: "Un e-mail de confirmation a √©t√© envoy√© dans votre bo√Æte de r√©ception.",
        success_pickup_title: "Points de Retrait",
        success_continue: "Continuer vos Achats",
        // Cart
        cart_empty_msg: "Votre panier est vide.",
        toast_added: "Ajout√© au panier",
        // Trust & Why
        trust_food_safe: "Certifi√© Alimentaire",
        trust_iso: "Qualit√© Certifi√©e ISO 9001",
        trust_fast_ship: "Pr√©paration Rapide 24h",
        trust_best_price: "Meilleur Prix Garanti",
        why_eyebrow: "La Diff√©rence ProTech",
        why_title: "Pourquoi choisir ProTech ?",
        why_direct_title: "Direct d'Usine",
        why_direct_desc: "Pas d'interm√©diaires. Nous fabriquons chaque plaque pour garantir la meilleure qualit√©.",
        why_packaging_title: "Protection Premium",
        why_packaging_desc: "Chaque RVS Platen est livr√©e avec un film laser haute r√©sistance.",
        why_custom_title: "Coupe de Pr√©cision",
        why_custom_desc: "D√©coupe laser fibre pour un ajustement parfait au millim√®tre pr√®s.",
        shipping_free_unlocked: "Livraison gratuite d√©bloqu√©e !",
        shipping_away_prefix: "Plus que",
        shipping_away_suffix: "pour la livraison GRATUITE !"
    }
};

let currentLang = localStorage.getItem('protech_lang') || 'en';

function changeLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('protech_lang', lang);
    document.documentElement.lang = lang;

    // Update active flag
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('onclick').includes(lang));
    });

    // Update simple text elements
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang][key]) {
            el.innerHTML = translations[lang][key];
        }
    });

    // Update Product Data (Live)
    // We update the product array in memory so re-renders pick it up
    products[0].title = translations[lang].product_title;
    products[0].desc = translations[lang].product_desc;
    products[0].material = translations[lang].mat_desc;
    products[0].features[0].text = translations[lang].feat_iso;
    products[0].features[1].text = translations[lang].feat_heat;
    products[0].features[2].text = translations[lang].feat_food;
    products[0].features[3].text = translations[lang].feat_dual;

    // Refresh Views
    renderProducts();
    updateCart(); // Update cart text if needed (checkout button)

    // NEW: Update URL for SEO (query based)
    const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?lang=' + lang;
    window.history.pushState({ path: newUrl }, '', newUrl);
}

const products = [
    {
        id: "rvs-304-premium",
        title: "Professional AISI 304 Stainless Steel Sheet", // Will be overwritten by init

        price: 329.99,
        image: "images/rvs-spec-sheet.jpg",
        material: "1 Side Brushed / 1 Side Polished Mirror",
        desc: "Premium AISI 304 stainless steel backsplash sheet with professional dual finish. One side features a refined brushed texture, the other a mirror-polished surface. Laser protection film applied on polished side for scratch-free delivery. Certified for professional kitchen environments and direct food contact.",
        features: [
            { icon: "fa-certificate", text: "ISO Standard" },
            { icon: "fa-fire-burner", text: "Heat Resistant" },
            { icon: "fa-utensils", text: "Food Certified" },
            { icon: "fa-universal-access", text: "Dual Surface" }
        ],
        sizes: [
            { label: "3000 x 1500 mm", area: "4.5 m¬≤", price: 369.99 },
            { label: "2000 x 1000 mm", area: "2.0 m¬≤", price: 329.99 }
        ],
        stock: 50
    }
];

let selectedSizeIndex = -1; // No preselection - user must choose
let currentOpenProductId = null;

// Load cart and FIX any items with undefined uniqueId
let cart = JSON.parse(localStorage.getItem('metallum_apple_cart')) || [];

// MIGRATION: Fix old cart items without uniqueId
cart = cart.map((item, index) => {
    if (!item.uniqueId || item.uniqueId === 'undefined') {
        const size = item.selectedSize || '3000x1500mm';
        item.uniqueId = `${item.id || 'product'}-${size.replace(/\s+/g, '')}-${Date.now()}-${index}`;
        console.log('Fixed cart item uniqueId:', item.uniqueId);
    }
    return item;
});

// Save fixed cart
localStorage.setItem('metallum_apple_cart', JSON.stringify(cart));
const stripe = Stripe('pk_live_51SzzzzQECx6xOqcU366GElFvHtQ2ZYIUpj1OCbBXcISlsV1CbOFEE1IEEU8AXpVIpuVBCWZIlOotOEFYIs0ojOSq00orS8vc5b');

// DOM Elements
const productGrid = document.getElementById('product-grid');
const cartSidebar = document.getElementById('cart-sidebar');
const cartOverlay = document.getElementById('cart-overlay');
const cartCount = document.getElementById('cart-count');
const cartTotal = document.getElementById('cart-total-price');

// Customizer Elements
const custWidth = document.getElementById('cust-width');
const custHeight = document.getElementById('cust-height');
const custMaterial = document.getElementById('cust-material');
const valWidth = document.getElementById('cust-width-num');
const valHeight = document.getElementById('cust-height-num');
const priceDisplay = document.getElementById('cust-price');
const platePreview = document.getElementById('plate-preview');
const labelW = document.getElementById('label-w');
const labelH = document.getElementById('label-h');

// Initialize
function init() {
    // Check for lang in URL first
    const urlParams = new URLSearchParams(window.location.search);
    const langUrl = urlParams.get('lang');
    if (langUrl && translations[langUrl]) {
        currentLang = langUrl;
        localStorage.setItem('protech_lang', langUrl);
    }

    // Set current language immediately
    changeLanguage(currentLang);

    renderProducts();
    updateCartUI();
    handleSuccess();
    initCustomizer();
    setupListeners();
    initScrollAnimations();
    setupLogoFallback();
}

function setupLogoFallback() {
    const logos = document.querySelectorAll('.brand-logo, .footer-brand img');
    logos.forEach(img => {
        img.onerror = () => {
            img.style.display = 'none';
            const parent = img.parentElement;
            if (parent) {
                const text = document.createElement('span');
                text.innerHTML = '<i class="fas fa-shield-alt"></i> ProTech Solutions';
                text.style.fontWeight = '600';
                text.style.fontSize = parent.classList.contains('logo') ? '1.2rem' : '1rem';
                if (parent.classList.contains('footer-brand')) text.style.color = '#fff';
                parent.insertBefore(text, img);
            }
        };
    });
}

function handleSuccess() {
    const params = new URLSearchParams(window.location.search);
    const sessionId = params.get('session_id');

    if (params.get('success') === 'true' && sessionId) {
        // Clear cart
        localStorage.removeItem('metallum_apple_cart');
        cart = [];
        updateCartUI();

        // Fetch session details to get shipping info
        fetch(`/session-details/${sessionId}`)
            .then(res => res.json())
            .then(data => {
                // Update shipping info in modal
                updateShippingInfo(data);

                // Show Professional Modal
                const successModal = document.getElementById('success-modal');
                if (successModal) {
                    successModal.classList.add('active');
                }
            })
            .catch(err => {
                console.error('Error fetching session:', err);
                // Show modal anyway, just without specific shipping details
                const successModal = document.getElementById('success-modal');
                if (successModal) {
                    successModal.classList.add('active');
                }
            });

        // Clean URL
        window.history.replaceState({}, document.title, window.location.pathname);
    }
}

function updateShippingInfo(data) {
    const pickupBox = document.querySelector('.pickup-locations-box');
    if (!pickupBox || !data) return;

    const shipping = data.shipping;
    const methodName = data.shippingMethodName || '';
    const address = shipping?.address;

    // Check if it's a pickup (Stripe rate name contains "Pickup")
    const isPickup = methodName.toLowerCase().includes('pickup');

    if (isPickup) {
        // Show pickup location based on which one was selected
        if (methodName.includes('Mechelen') || methodName.includes('Blarenberglaan')) {
            pickupBox.innerHTML = `
                <h3><i class="fas fa-location-dot"></i> Pickup Location</h3>
                <p class="pickup-addr">üìç Blarenberglaan 6, 2800 Mechelen (GGM Gastro)</p>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">Your order will be ready for pickup in 3-5 business days.</p>
            `;
        } else if (methodName.includes('Hechtel') || methodName.includes('Overpelterbaan')) {
            pickupBox.innerHTML = `
                <h3><i class="fas fa-location-dot"></i> Pickup Location</h3>
                <p class="pickup-addr">üìç Overpelterbaan 66, 3941 Hechtel-EKSEL</p>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">Your order will be ready for pickup in 3-5 business days.</p>
            `;
        }
    } else if (address) {
        // Show delivery address
        const addr = address;
        const fullAddress = `${addr.line1}${addr.line2 ? ', ' + addr.line2 : ''}, ${addr.postal_code} ${addr.city}, ${addr.country}`;

        pickupBox.innerHTML = `
            <h3><i class="fas fa-truck"></i> Delivery Address</h3>
            <p class="pickup-addr">üì¶ ${fullAddress}</p>
            <p style="margin-top: 10px; color: #666; font-size: 14px;">Your order will be delivered in 3-5 business days.</p>
        `;
    }
}

window.closeSuccessModal = function () {
    document.getElementById('success-modal').classList.remove('active');
}

// Visual Customizer
function initCustomizer() {
    if (!custWidth) return;
    const custWidthNum = document.getElementById('cust-width-num');
    const custHeightNum = document.getElementById('cust-height-num');

    const updateUI = (source) => {
        let w, h;

        if (source === 'range') {
            w = parseInt(custWidth.value);
            h = parseInt(custHeight.value);
            custWidthNum.value = w;
            custHeightNum.value = h;
        } else {
            w = parseInt(custWidthNum.value) || 500;
            h = parseInt(custHeightNum.value) || 300;
            custWidth.value = w;
            custHeight.value = h;
        }

        const material = custMaterial.value;

        // Visual labels
        labelW.innerText = `${w}mm`;
        labelH.innerText = `${h}mm`;

        // Scale Visual Plate
        const scale = 0.1;
        platePreview.style.width = `${w * scale}px`;
        platePreview.style.height = `${h * scale}px`;

        // Price Calc (Aligned with Catalog: ‚Ç¨85 per m2 for 304 Brushed + base ‚Ç¨25 fee)
        const areaM2 = (w / 1000) * (h / 1000);
        const rate = material === '304' ? 85 : 85;
        const total = (areaM2 * rate) + 25;

        priceDisplay.innerText = `‚Ç¨${total.toFixed(2)}`;
    };

    custWidth.oninput = () => updateUI('range');
    custHeight.oninput = () => updateUI('range');
    custWidthNum.oninput = () => updateUI('num');
    custHeightNum.oninput = () => updateUI('num');
    custMaterial.onchange = () => updateUI('range');

    updateUI('range'); // Init call
}

window.requestCustomQuote = function () {
    const w = custWidth.value;
    const h = custHeight.value;
    const mat = custMaterial.options[custMaterial.selectedIndex].text;
    const price = priceDisplay.innerText;

    const subject = encodeURIComponent(`Bespoke Design Request: ${w}x${h}mm`);
    const body = encodeURIComponent(`I am interested in a custom backsplash:\n\nMaterial: ${mat}\nDimensions: ${w}mm x ${h}mm\nEstimated Price: ${price}\n\nPlease contact me to finalize.`);

    // GA Event: Custom Quote Request
    if (typeof gtag === 'function') {
        gtag('event', 'generate_lead', {
            event_category: 'engagement',
            event_label: 'custom_quote',
            value: parseFloat(price.replace('‚Ç¨', '')) || 0
        });
    }

    window.location.href = `mailto:protechtsolutions.orders@gmail.com?subject=${subject}&body=${body}`;
}

// Render Products
// Render Products
function renderProducts() {
    if (!productGrid) return;
    const t = translations[currentLang]; // Get current translations
    productGrid.innerHTML = products.map(p => `
        <div class="product-item stagger-item">
            ${p.stock < 20 ? `<span class="stock-badge">${t.stock_low.replace('{n}', p.stock)}</span>` : ''}
            <h3 class="p-title">${p.title}</h3>
            <p class="p-price">${t.price_from} ‚Ç¨${p.price}</p>
            <img src="${p.image}" alt="${p.title}">
            <div>
                <button class="btn-buy-small" onclick="openModal('${p.id}')">${t.btn_buy_small}</button>
            </div>
        </div>
    `).join('');
}

// Modal
window.openModal = function (id) {
    currentOpenProductId = id;
    const p = products.find(x => x.id === id);
    if (!p) return;

    document.getElementById('modal-img').src = p.image;
    document.getElementById('modal-title').innerText = p.title;
    document.getElementById('modal-price').innerText = `‚Ç¨${p.price.toFixed(2)}`;
    document.getElementById('modal-desc').innerText = p.desc;
    document.getElementById('modal-material').innerText = p.material;

    // Features
    const featureContainer = document.getElementById('modal-features');
    if (p.features) {
        featureContainer.innerHTML = p.features.map(f => `
            <div class="feature-tag"><i class="fas ${f.icon}"></i> ${f.text}</div>
        `).join('');
    }

    // Render Size Options
    const sizeOptions = document.getElementById('size-options');
    sizeOptions.innerHTML = p.sizes.map((s, idx) => `
        <div class="variant-box ${idx === selectedSizeIndex ? 'active' : ''}" onclick="selectSize(${idx})">
            ${s.label}
        </div>
    `).join('');

    updateModalDimensions(p);

    // Update stock info
    const shippingInfo = document.querySelector('.shipping-info');
    const t = translations[currentLang];
    if (p.stock < 20) {
        shippingInfo.innerHTML = `<i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i> <span style="color: #ef4444; font-weight: 600;">${t.stock_low.replace('{n}', p.stock)}</span>`;
    } else {
        shippingInfo.innerHTML = `<i class="fas fa-box"></i> ${t.stock_ok}`;
    }

    const modal = document.getElementById('product-modal');
    modal.classList.add('active');

    const modalAddBtn = document.getElementById('modal-add-btn');
    modalAddBtn.onclick = () => {
        // Check if size is selected
        const activeSize = document.querySelector('.variant-box.active');
        if (!activeSize) {
            // Scroll to size selector and highlight it
            const sizeSelector = document.getElementById('modal-variant-selector');
            if (sizeSelector) {
                sizeSelector.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // Add pulsing animation to draw attention
                sizeSelector.style.animation = 'pulse 0.6s ease-in-out 2';
                setTimeout(() => {
                    sizeSelector.style.animation = '';
                }, 1200);
            }
            return; // Don't add to cart yet
        }
        // Size is selected, proceed with adding to cart
        window.addToCart();
    };

    // Initialize Modal Spin
    initModal3D();
}

window.closeModal = function () {
    document.getElementById('product-modal').classList.remove('active');
    const overlay = document.getElementById('modal-overlay');
    if (overlay) overlay.classList.remove('active');
}

window.selectSize = function (idx) {
    selectedSizeIndex = idx;
    const boxes = document.querySelectorAll('.variant-box');
    boxes.forEach((b, i) => {
        if (i === idx) b.classList.add('active');
        else b.classList.remove('active');
    });

    // Update Price based on size
    const p = products.find(prod => prod.id === currentOpenProductId);
    if (p && p.sizes[idx] && p.sizes[idx].price) {
        document.getElementById('modal-price').innerText = `‚Ç¨${p.sizes[idx].price.toFixed(2)}`;
    }

    updateModalDimensions(products.find(p => p.id === currentOpenProductId));
}

function updateModalDimensions(p) {
    if (!p) return; // Guard clause
    const t = translations[currentLang];

    // If no size selected yet, show placeholder
    if (selectedSizeIndex === -1 || !p.sizes[selectedSizeIndex]) {
        document.getElementById('modal-dims').innerHTML = `
            <span style="color: #888;">${t.modal_dims_placeholder}</span>
        `;
        return;
    }

    const size = p.sizes[selectedSizeIndex];
    document.getElementById('modal-dims').innerHTML = `
        ${size.area} (${size.label}) <br> 
        <div class="bonus-tag">${t.modal_laser_bonus}</div>
    `;
}

// Cart Logic
window.addToCart = function () {
    const p = products.find(prod => prod.id === currentOpenProductId);
    const size = p.sizes[selectedSizeIndex];

    // Add size to the item
    const cartItem = {
        ...p,
        selectedSize: size.label,
        price: size.price || p.price, // Use size specific price
        uniqueId: `${p.id}-${size.label.replace(/\s+/g, '')}`
    };

    const existing = cart.find(item => item.uniqueId === cartItem.uniqueId);
    if (existing) {
        existing.qty++;
    } else {
        cartItem.qty = 1;
        cart.push(cartItem);
    }

    localStorage.setItem('metallum_apple_cart', JSON.stringify(cart));
    updateCartUI();
    closeModal();
    openCart();

    // Feedback Animation
    showToast(translations[currentLang].toast_added);

    // GA Event: Add to Cart
    if (typeof gtag === 'function') {
        gtag('event', 'add_to_cart', {
            currency: 'EUR',
            value: cartItem.price,
            items: [{
                item_id: p.id,
                item_name: p.title,
                price: cartItem.price,
                quantity: 1
            }]
        });
    }

    const badge = document.getElementById('cart-count');
    if (badge) {
        badge.classList.remove('pulse');
        void badge.offsetWidth; // Trigger reflow
        badge.classList.add('pulse');
    }
};

function showToast(msg) {
    let toast = document.getElementById('toast-feedback');
    if (!toast) {
        toast = document.createElement('div');
        toast.id = 'toast-feedback';
        toast.className = 'toast-feedback';
        document.body.appendChild(toast);
    }
    toast.innerText = msg;
    toast.classList.add('active');
    setTimeout(() => toast.classList.remove('active'), 2500);
}

function initModal3D() {
    const visual = document.querySelector('.modal-visual');
    const img = document.getElementById('modal-img');
    if (!visual || !img) return;

    // Reset transform on start
    img.style.transform = `rotateY(0deg)`;

    visual.onmousemove = (e) => {
        const rect = visual.getBoundingClientRect();
        const x = e.clientX - rect.left;

        // Calculate rotation based on horizontal position (Nike-style spin)
        // Mapping horizontal position to a -180 to 180 or -90 to 90 spin
        const percent = x / rect.width;
        const rotateY = (percent - 0.5) * 60; // 60 degree total swing for subtlety

        img.style.transform = `rotateY(${rotateY}deg) scale(1.05)`;
    };

    visual.onmouseleave = () => {
        img.style.transform = `rotateY(0deg) scale(1)`;
    };
}

function init3DEffects() {
    // Legacy removed for stability
}

function removeFromCart(id) {
    cart = cart.filter(x => x.uniqueId !== id);
    saveCart();
    updateCartUI();
}

window.updateQty = function (id, delta) {
    const item = cart.find(x => x.uniqueId === id);
    if (!item) return;

    item.qty += delta;
    if (item.qty <= 0) {
        removeFromCart(id);
    } else {
        saveCart();
        updateCartUI();
    }
    updateShippingProgress();
}

function updateShippingProgress() {
    const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
    const threshold = 599.99;
    const progressContainer = document.getElementById('shipping-progress-container');
    if (!progressContainer) return;

    if (total === 0) {
        progressContainer.style.display = 'none';
        return;
    }

    progressContainer.style.display = 'block';
    const fill = document.getElementById('shipping-progress-fill');
    const text = document.getElementById('shipping-progress-text');
    const percentage = Math.min((total / threshold) * 100, 100);

    fill.style.width = `${percentage}%`;

    const t = translations[currentLang];
    if (total >= threshold) {
        text.innerHTML = `<i class="fas fa-check-circle"></i> ${t.shipping_free_unlocked}`;
        fill.style.background = '#10b981';
    } else {
        const remaining = (threshold - total).toFixed(2);
        text.innerHTML = `${t.shipping_away_prefix} <strong>‚Ç¨${remaining}</strong> ${t.shipping_away_suffix}`;
        fill.style.background = 'var(--accent)';
    }
}

function saveCart() {
    localStorage.setItem('metallum_apple_cart', JSON.stringify(cart));
}

function updateCartUI() {
    if (!cartCount || !cartTotal) return;
    const totalQty = cart.reduce((a, b) => a + b.qty, 0);
    cartCount.innerText = totalQty;
    cartCount.style.display = totalQty > 0 ? 'inline-block' : 'none';

    const itemsContainer = document.getElementById('cart-items');
    if (!itemsContainer) return;

    if (cart.length === 0) {
        itemsContainer.innerHTML = `<p style="text-align:center; color:#999; margin-top:20px;">${translations[currentLang].cart_empty_msg}</p>`;
        cartTotal.innerText = "‚Ç¨0.00";
    } else {
        itemsContainer.innerHTML = cart.map((item, idx) => `
            <div class="cart-item">
                <img src="${item.image}">
                <div style="flex:1;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span style="font-weight:600;">${item.title}</span>
                        <span style="font-weight:600;">‚Ç¨${item.price.toFixed(2)}</span>
                    </div>
                    <div style="font-size:0.85rem; color:#888;">Size: ${item.selectedSize || 'Standard'}</div>
                    <div class="qty-controls" style="margin-top:8px;">
                        <button class="qty-btn" data-action="minus" data-id="${item.uniqueId}" type="button">-</button>
                        <span style="font-weight:600; min-width:20px; text-align:center;">${item.qty}</span>
                        <button class="qty-btn" data-action="plus" data-id="${item.uniqueId}" type="button">+</button>
                    </div>
                    <button class="remove-item" data-action="remove" data-id="${item.uniqueId}" type="button">Remove</button>
                </div>
            </div>
        `).join('');

        const total = cart.reduce((a, b) => a + (b.price * b.qty), 0);
        cartTotal.innerText = `‚Ç¨${total.toFixed(2)}`;

        // RE-ATTACH event listeners after HTML update (CRITICAL FIX)
        attachCartListeners();
    }
}

// Separate function to attach cart listeners
function attachCartListeners() {
    const itemsContainer = document.getElementById('cart-items');
    if (!itemsContainer) return;

    // Remove old listener if exists
    const newContainer = itemsContainer.cloneNode(true);
    itemsContainer.parentNode.replaceChild(newContainer, itemsContainer);

    // Add fresh listener
    newContainer.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-action]');
        if (!btn) return;

        e.preventDefault();
        e.stopPropagation();

        const id = btn.dataset.id;
        const action = btn.dataset.action;

        console.log('Cart action:', action, id);

        if (action === 'plus') window.updateQty(id, 1);
        else if (action === 'minus') window.updateQty(id, -1);
        else if (action === 'remove') window.removeFromCart(id);
    });
}

function openCart() {
    cartSidebar.classList.add('open');
    cartOverlay.classList.add('active');
}

function closeCart() {
    cartSidebar.classList.remove('open');
    cartOverlay.classList.remove('active');
}

// Listeners
function setupListeners() {
    const closeBtn = document.querySelector('.close-modal');
    if (closeBtn) closeBtn.onclick = closeModal;

    const closeCartBtn = document.querySelector('.close-cart');
    if (closeCartBtn) closeCartBtn.onclick = closeCart;

    if (cartOverlay) cartOverlay.onclick = closeCart;

    const modalOverlay = document.getElementById('modal-overlay');
    if (modalOverlay) modalOverlay.onclick = closeModal;

    const cartBtn = document.getElementById('cart-btn');
    if (cartBtn) {
        cartBtn.onclick = (e) => { e.preventDefault(); openCart(); };
    }

    const checkoutBtn = document.getElementById('checkout-btn');
    if (checkoutBtn) {
        checkoutBtn.onclick = async () => {
            if (cart.length === 0) return alert(translations[currentLang].cart_empty_msg || "Your bag is empty.");

            const originalText = checkoutBtn.innerHTML;
            checkoutBtn.innerHTML = 'Processing...';
            checkoutBtn.disabled = true;

            // GA Event: Begin Checkout
            if (typeof gtag === 'function') {
                gtag('event', 'begin_checkout', {
                    currency: 'EUR',
                    value: cart.reduce((sum, item) => sum + (item.price * item.qty), 0),
                    items: cart.map(item => ({
                        item_id: item.id,
                        item_name: item.title,
                        price: item.price,
                        quantity: item.qty
                    }))
                });
            }

            try {
                const response = await fetch('/create-checkout-session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cart: cart })
                });

                const data = await response.json();
                if (data.url) {
                    window.location.href = data.url;
                } else {
                    alert("Error: " + (data.error || "Please try again later."));
                    checkoutBtn.innerHTML = originalText;
                    checkoutBtn.disabled = false;
                }
            } catch (err) {
                console.error(err);
                alert("Connection failed.");
                checkoutBtn.innerHTML = originalText;
                checkoutBtn.disabled = false;
            }
        };
    }
}

// Premium Animations
function initScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px"
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('reveal-active');

                // If it's a grid/shelf, trigger its children with stagger
                if (entry.target.classList.contains('product-shelf') || entry.target.classList.contains('faq-grid')) {
                    const children = entry.target.querySelectorAll('.product-item, .faq-item');
                    children.forEach((child, index) => {
                        setTimeout(() => {
                            child.classList.add('reveal-active');
                        }, index * 100);
                    });
                }
            }
        });
    }, observerOptions);

    // Observe sections and special elements
    document.querySelectorAll('.reveal, .product-shelf, .faq-grid, .feature-big, .content-section').forEach(el => {
        observer.observe(el);
    });
}

// Global Exports
window.removeFromCart = removeFromCart;
document.addEventListener('DOMContentLoaded', () => {
    init();
});
